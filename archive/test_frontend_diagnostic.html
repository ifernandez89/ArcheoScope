<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Diagn√≥stico ArcheoScope</title>
    <style>
        body { font-family: monospace; padding: 2rem; background: #f8f9fa; }
        .test-section { background: white; padding: 1.5rem; margin: 1rem 0; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .test-button { background: #007bff; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 4px; cursor: pointer; margin: 0.5rem; }
        .test-button:hover { background: #0056b3; }
        .result { background: #f8f9fa; padding: 1rem; border-radius: 4px; margin-top: 1rem; border-left: 4px solid #007bff; }
        .critical { border-left-color: #dc3545; background: #fadbd8; }
        .limited { border-left-color: #fd7e14; background: #fff3cd; }
        .valid { border-left-color: #ffc107; background: #d1ecf1; }
        .optimal { border-left-color: #28a745; background: #d4edda; }
    </style>
</head>
<body>
    <h1>üî¨ Test del Sistema de Diagn√≥stico Cient√≠fico</h1>
    
    <div class="test-section">
        <h2>üéØ Objetivo</h2>
        <p>Verificar que el nuevo sistema de diagn√≥stico cient√≠fico de datos funciona correctamente y proporciona retroalimentaci√≥n honesta sobre la calidad de los datos disponibles.</p>
    </div>
    
    <div class="test-section">
        <h2>üß™ Tests Autom√°ticos</h2>
        <button class="test-button" onclick="testLowResolution()">Test Resoluci√≥n Baja (500m)</button>
        <button class="test-button" onclick="testHighResolution()">Test Resoluci√≥n Alta (10m)</button>
        <button class="test-button" onclick="testOptimalData()">Test Datos √ìptimos</button>
        
        <div id="testResults"></div>
    </div>
    
    <div class="test-section">
        <h2>üåê Frontend Principal</h2>
        <p>Para probar la interfaz completa:</p>
        <a href="http://localhost:8080" target="_blank" style="display: inline-block; background: #28a745; color: white; padding: 0.75rem 1.5rem; text-decoration: none; border-radius: 4px;">
            üè∫ Abrir ArcheoScope
        </a>
    </div>
    
    <div class="test-section">
        <h2>üìã Instrucciones de Prueba</h2>
        <ol>
            <li><strong>Coordenadas de prueba:</strong> 41.85, 12.50 (Roma)</li>
            <li><strong>Resoluci√≥n 500m:</strong> Deber√≠a mostrar diagn√≥stico CR√çTICO üî¥</li>
            <li><strong>Resoluci√≥n 10m:</strong> Deber√≠a mostrar diagn√≥stico MEJORADO üü°</li>
            <li><strong>Buscar secci√≥n:</strong> "üî¨ Diagn√≥stico Cient√≠fico de Datos"</li>
            <li><strong>Mensaje esperado:</strong> "necesito ver mejor para hablar"</li>
        </ol>
    </div>

    <script>
        const API_BASE = 'http://localhost:8004';
        
        function showResult(message, type = 'info') {
            const resultsDiv = document.getElementById('testResults');
            const resultDiv = document.createElement('div');
            resultDiv.className = `result ${type}`;
            resultDiv.innerHTML = message;
            resultsDiv.appendChild(resultDiv);
        }
        
        async function testLowResolution() {
            showResult('üîç Testing resoluci√≥n baja (500m)...', 'info');
            
            const testData = {
                lat_min: 41.85,
                lat_max: 41.86,
                lon_min: 12.50,
                lon_max: 12.51,
                resolution_m: 500,
                region_name: "Test Low Resolution",
                include_explainability: true,
                include_validation_metrics: true,
                layers_to_analyze: ["ndvi_vegetation", "thermal_lst"],
                active_rules: ["all"]
            };
            
            try {
                const response = await fetch(`${API_BASE}/analyze`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(testData)
                });
                
                if (response.ok) {
                    const data = await response.json();
                    const resolution = data.region_info?.resolution_m || 'unknown';
                    const temporalWindows = data.temporal_analysis?.available_windows || 0;
                    
                    showResult(`
                        ‚úÖ <strong>Test Resoluci√≥n Baja Completado</strong><br>
                        ‚Ä¢ Resoluci√≥n: ${resolution}m<br>
                        ‚Ä¢ Ventanas temporales: ${temporalWindows}<br>
                        ‚Ä¢ <strong>Diagn√≥stico esperado:</strong> üî¥ CR√çTICO<br>
                        ‚Ä¢ <strong>Raz√≥n:</strong> Resoluci√≥n > 30m, ventanas temporales < 3<br>
                        ‚Ä¢ <strong>Mensaje:</strong> "necesito ver mejor para hablar"
                    `, 'critical');
                } else {
                    showResult(`‚ùå Error: ${response.status}`, 'critical');
                }
            } catch (error) {
                showResult(`‚ùå Error: ${error.message}`, 'critical');
            }
        }
        
        async function testHighResolution() {
            showResult('üîç Testing resoluci√≥n alta (10m)...', 'info');
            
            const testData = {
                lat_min: 41.85,
                lat_max: 41.86,
                lon_min: 12.50,
                lon_max: 12.51,
                resolution_m: 10,
                region_name: "Test High Resolution",
                include_explainability: true,
                include_validation_metrics: true,
                layers_to_analyze: ["ndvi_vegetation", "thermal_lst", "sar_backscatter"],
                active_rules: ["all"]
            };
            
            try {
                const response = await fetch(`${API_BASE}/analyze`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(testData)
                });
                
                if (response.ok) {
                    const data = await response.json();
                    const resolution = data.region_info?.resolution_m || 'unknown';
                    
                    showResult(`
                        ‚úÖ <strong>Test Resoluci√≥n Alta Completado</strong><br>
                        ‚Ä¢ Resoluci√≥n: ${resolution}m<br>
                        ‚Ä¢ <strong>Diagn√≥stico esperado:</strong> üü° V√ÅLIDO (pero limitado)<br>
                        ‚Ä¢ <strong>Raz√≥n:</strong> Resoluci√≥n adecuada, pero faltan datos temporales<br>
                        ‚Ä¢ <strong>Mejora:</strong> Menos cr√≠tico que resoluci√≥n baja
                    `, 'valid');
                } else {
                    showResult(`‚ùå Error: ${response.status}`, 'critical');
                }
            } catch (error) {
                showResult(`‚ùå Error: ${error.message}`, 'critical');
            }
        }
        
        async function testOptimalData() {
            showResult('üîç Testing datos √≥ptimos (simulado)...', 'info');
            
            showResult(`
                ‚úÖ <strong>Simulaci√≥n de Datos √ìptimos</strong><br>
                ‚Ä¢ Resoluci√≥n: 10m ‚úÖ<br>
                ‚Ä¢ Series temporales: 5 a√±os ‚úÖ<br>
                ‚Ä¢ Contexto geomorfol√≥gico: Disponible ‚úÖ<br>
                ‚Ä¢ Huella humana moderna: Mapeada ‚úÖ<br>
                ‚Ä¢ Ground truth: Sitios conocidos ‚úÖ<br>
                ‚Ä¢ Microtopograf√≠a: LiDAR ‚úÖ<br>
                ‚Ä¢ <strong>Diagn√≥stico esperado:</strong> ‚úÖ √ìPTIMO<br>
                ‚Ä¢ <strong>Mensaje:</strong> "Datos √≥ptimos para interpretaci√≥n cient√≠fica"
            `, 'optimal');
        }
        
        // Auto-ejecutar test b√°sico al cargar
        window.onload = function() {
            showResult(`
                üè∫ <strong>Sistema de Diagn√≥stico ArcheoScope</strong><br>
                Backend: ${API_BASE} ‚úÖ<br>
                Frontend: http://localhost:8080 ‚úÖ<br>
                <em>Listo para testing del diagn√≥stico cient√≠fico</em>
            `, 'info');
        };
    </script>
</body>
</html>